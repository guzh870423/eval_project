<html>
  <head>    
    
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <style type="text/css">
        h2 {page-break-before: always}
       
    </style>
  </head>
  <body>
    <h1>Reports for semester {{semester.year}} {{ semester.season }} {{ semester.course_no }}, week {{currentWeek}}</h2>
    <p id="demo"></p>

    <script>
        document.getElementById("demo").innerHTML = Date();
    </script>
    <div class="container">
    {% if missingNames %}
    <h2>Students
    {% for name in missingNames %}
    {{names[name]}}, 
    {% endfor %}
    have not submitted evals yet.
    </h2>
    {% endif %}
    <h2>Average ranks </h2>
    <div class="row">
    <div class ="col-md-6 col-md-push-3">
    <table class="table table-hover">
        <caption>
            normalized rank =  rank / number of reviews given by evaler. Range: (0,1]<br>
            normalized token = token * number of reviews given by evaler.
        </caption>
        <tr>
            <th>student</th>
            <th>unweigh. avg. rank</th>
            <th>weigh. avg. rank</th>
            <th>norm. avg. token</th>
            <th>NO. of reveiws</th>
        </tr>
        {% for student_id in sortedByAverageRank %}
                <tr>
                    <td>{{ names[student_id] }}</td>
                    <td>{{averageRank[currentWeek-1][student_id]}}</td>
                    <td>{{weightedRank[student_id]}}</td>
                    <td>{{averageToken[currentWeek-1][student_id]}}</td>
                    <td>{{len(reversedEvals[currentWeek-1][student_id])}}</td>
                </tr>
        {% endfor %}
    </table>
    </div>
    </div>
    <div>
    {% include 'charts/compare.html' %}
    </div>
  
    
    
    
    {% for student in students %}
        {% if student.is_active %}
        <br>
        <h2>Evalee: {{ names[student.user_name] }}</h2>
        {% if currentWeek > 1 and averageRank[currentWeek-1].get(student.user_name) and averageRank[currentWeek-2].get(student.user_name) %}
            </p>Average rank: {{ averageRank[currentWeek-1][student.user_name] }}, 
            change {{ averageRank[currentWeek-1][student.user_name]-averageRank[currentWeek-2][student.user_name] }} 
            from last week.</p>
        {% endif %}
        <div class="row">
            <div class ="col-md-6 col-md-push-3">
            <table class="table table-hover">
            
            <tr>
                <th>Evaler</th>
                <th>team week</th>
                <th>No. rev.</th>
                <th>Nm. rk</th>
                <th>Nm. tkn</th>
                <th>Adjective</th>
                <th>Description</th>
            </tr>
            {% if sortedEvaler[currentWeek-1].get(student.user_name) %}
            {% for evaler in sortedEvaler[currentWeek-1][student.user_name][0] %}
                <tr>
                    <td>{{ names[evaler] }}</th>
                    <td>{{ connection[student.user_name][evaler] }}</th>
                    <td>{{ len(evals[currentWeek-1][evaler]) }}</th>
                    <td>{{ reversedEvals[currentWeek-1][student.user_name][evaler][1] }}</th>
                    <td>{{ reversedEvals[currentWeek-1][student.user_name][evaler][2] }}</th>
                    <td>{{ reversedEvals[currentWeek-1][student.user_name][evaler][0].adjective }}</th>
                    <td>{{ reversedEvals[currentWeek-1][student.user_name][evaler][0].description }}</th>
                </tr>
            {% endfor %}
            {% if sortedEvaler[currentWeek-1][student.user_name][1] %}
            <tr class="info"><td colspan="7"></td></tr>
            {% for evaler in sortedEvaler[currentWeek-1][student.user_name][1] %}
                <tr>
                    <td>{{ names[evaler] }}</th>
                    <td>{{ connection[student.user_name][evaler] }}</th>
                    <td>{{ len(evals[currentWeek-1][evaler]) }}</th>
                    <td>{{ reversedEvals[currentWeek-1][student.user_name][evaler][1] }}</th>
                    <td>{{ reversedEvals[currentWeek-1][student.user_name][evaler][2] }}</th>
                    <td>{{ reversedEvals[currentWeek-1][student.user_name][evaler][0].adjective }}</th>
                    <td>{{ reversedEvals[currentWeek-1][student.user_name][evaler][0].description }}</th>
                </tr>
            {% endfor %}
            {% endif %}
            {% endif %}
        </table>
    </div>
    </div>
        {% include 'charts/' + student.user_name + '.html' %}
      {% endif %}
    {% endfor %}
    </div>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
  </body>
</html>